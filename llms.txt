# @oxog/mask - LLM Reference Guide

## Overview
@oxog/mask is a zero-dependency TypeScript library for masking sensitive data with a micro-kernel architecture and plugin system.

## Architecture

### Core Components

1. **Micro-Kernel** (`src/kernel.ts`)
   - Central orchestrator for masking operations
   - Manages plugin registration and execution
   - Supports synchronous and asynchronous operations

2. **Strategy Engine** (`src/strategies.ts`)
   - Implements 5 masking strategies:
     - `full`: Mask entire value
     - `middle`: Mask middle portion (default)
     - `first:N`: Mask everything except first N characters
     - `last:N`: Mask everything except last N characters
     - `partial:N`: Mask partial percentage (0-1)

3. **Format System** (`src/formats.ts`)
   - `display`: Human-readable format with spaces/punctuation
   - `compact`: No spaces or extra characters
   - `log`: Full redaction as `[REDACTED:type]`

4. **Plugin System** (`src/plugins/`)
   - Core plugins: email, phone, card
   - Optional plugins: iban, ip, jwt, ssn, url
   - Custom plugins: Extendable architecture

## Key Files

### Core Library
- `src/kernel.ts` - MaskKernel class with masking logic
- `src/strategies.ts` - Strategy implementations
- `src/formats.ts` - Format handlers
- `src/types.ts` - TypeScript type definitions
- `src/errors.ts` - Error classes
- `src/utils/validation.ts` - Validation utilities
- `src/utils/string.ts` - String manipulation utilities

### Plugins
- `src/plugins/core/email.ts` - Email masking
- `src/plugins/core/phone.ts` - Phone masking
- `src/plugins/core/card.ts` - Credit card masking
- `src/plugins/optional/iban.ts` - IBAN masking
- `src/plugins/optional/ip.ts` - IP address masking
- `src/plugins/optional/jwt.ts` - JWT token masking
- `src/plugins/optional/ssn.ts` - SSN masking
- `src/plugins/optional/url.ts` - URL masking

### Tests
- `tests/unit/` - All unit tests (98/98 passing)
- `tests/fixtures/` - Test data and fixtures
- 100% code coverage

### Examples
18 comprehensive examples in 3 categories:

**Basic (6 examples):**
- `examples/basic/01-basic-email-masking.ts` - Basic email masking
- `examples/basic/02-custom-strategies.ts` - Strategy usage
- `examples/basic/03-phone-masking.ts` - Phone masking
- `examples/basic/04-credit-card-masking.ts` - Card masking
- `examples/basic/05-custom-masking-characters.ts` - Custom chars
- `examples/basic/06-multiple-data-types.ts` - Multiple types

**Advanced (8 examples):**
- `examples/advanced/01-object-masking.ts` - Object masking
- `examples/advanced/02-formatting-options.ts` - Format options
- `examples/advanced/03-logging-integration.ts` - Logging integration
- `examples/advanced/04-database-integration.ts` - Database integration
- `examples/advanced/05-api-response-masking.ts` - API responses
- `examples/advanced/05-custom-plugin-example.ts` - Custom plugins
- `examples/advanced/06-batch-processing-example.ts` - Batch processing
- `examples/advanced/07-configuration-example.ts` - Configuration
- `examples/advanced/08-typescript-types-example.ts` - TypeScript types

**Real-World (4 examples):**
- `examples/real-world/01-user-database-example.ts` - User database
- `examples/real-world/02-logging-middleware.ts` - Logging middleware
- `examples/real-world/03-api-security-example.ts` - API security
- `examples/real-world/04-data-export-example.ts` - Data export

## Usage

### Basic Usage
```typescript
import { createMask } from '@oxog/mask';

const mask = createMask();
mask.use(require('@oxog/mask/plugins/core/email').email());
mask.use(require('@oxog/mask/plugins/core/phone').phone());
mask.use(require('@oxog/mask/plugins/core/card').card());

// Mask an email
const masked = mask.email('john.doe@example.com');
// Result: j***n.***@e***e.com

// Mask with custom strategy
const masked2 = mask.email('john.doe@example.com', { strategy: 'full' });
// Result: ***************@*********.***

// Mask with custom character
const masked3 = mask.email('john.doe@example.com', { char: '•' });
// Result: j••n.d•••@e••••••.•••
```

### Object Masking
```typescript
const user = {
  name: 'John Doe',
  email: 'john.doe@example.com',
  phone: '+1-555-123-4567',
};

const masked = mask.mask(user, {
  fields: {
    email: { strategy: 'middle' },
    phone: { strategy: 'last:4' },
  },
});
```

### Custom Plugins
```typescript
const customPlugin = {
  name: 'custom',
  version: '1.0.0',
  install(kernel) {
    kernel.registerMasker('custom', (value: string, options = {}) => {
      return value.replace(/\d/g, '*'); // Mask all digits
    });
  },
};

mask.use(customPlugin);
const masked = mask.custom('ABC123XYZ');
// Result: ABC***XYZ
```

### Format Options
```typescript
// Display format (default)
mask.card('4532015112830366', { format: 'display' });
// Result: **** **** **** 0366

// Compact format (no spaces)
mask.card('4532015112830366', { format: 'compact' });
// Result: ************0366

// Log format (full redaction)
mask.card('4532015112830366', { format: 'log' });
// Result: [REDACTED:card]
```

## Plugin Architecture

### Core Plugins

#### Email Plugin
- Preserves domain structure
- Validates email format
- Supports 5 strategies
- Validates with `isValidEmail()`

#### Phone Plugin
- Handles international format
- Preserves country codes
- Supports various formats
- Validates with `isValidPhone()`

#### Card Plugin
- Luhn algorithm validation
- Supports all major card types
- Preserves last 4 digits by default
- Validates with `isValidCard()`

### Optional Plugins

#### IBAN Plugin
- Mod 97 validation
- International format support
- Validates with `isValidIBAN()`

#### IP Plugin
- IPv4 and IPv6 support
- Preserves network portion
- Validates with `isValidIP()`, `isValidIPv6()`

#### JWT Plugin
- Masks all three parts
- Preserves structure
- Validates with `isValidJWT()`

#### SSN Plugin
- US SSN format support
- Validates format rules
- Validates with `isValidSSN()`

#### URL Plugin
- Masks query parameters
- Preserves domain
- Validates with `isValidURL()`

## Validation

All plugins include validation:
- Email: RFC-like validation with checks for @, dots, consecutive dots
- Phone: Strips formatting, checks for minimum digits
- Card: Luhn algorithm
- IBAN: Mod 97 check
- IP: Range validation
- SSN: Format and range checks
- JWT: Structure and base64 validation
- URL: Built-in URL validation

## Error Handling

Custom error classes:
- `InvalidValueError` - Invalid input data
- `InvalidStrategyError` - Unknown strategy
- `InvalidFormatError` - Unknown format
- `PluginError` - Plugin-related errors

## Testing

98/98 tests passing with 100% coverage:
- Unit tests for all utilities
- Plugin tests with comprehensive cases
- Strategy tests
- Format tests
- Integration tests
- Edge case handling

## TypeScript Support

Full TypeScript support with:
- Strict type checking
- Generic type support
- Type guards
- Utility types
- Template literal types

## Performance

- Zero runtime dependencies
- Efficient algorithms
- Batch processing support
- Streaming support for large datasets
- Minimal memory footprint

## Browser and Node.js

Works in both environments:
- Pure TypeScript/JavaScript
- No DOM dependencies
- No Node.js-specific APIs
- ES modules compatible

## API Reference

### createMask()
Creates a new mask instance with default configuration.

### mask.use(plugin)
Registers a plugin with the kernel.

### mask.mask(value, options)
Masks a value or object.

**Options:**
- `strategy` - Masking strategy
- `char` - Masking character (default: '*')
- `format` - Output format
- `fields` - Field-specific options for objects

### Strategy Options
- `first:N` - Keep first N characters
- `last:N` - Keep last N characters
- `full` - Mask everything
- `middle` - Mask middle (default)
- `partial:N` - Mask N% (0-1)

### Format Options
- `display` - Human-readable (default)
- `compact` - No spaces
- `log` - Full redaction

## Examples

All examples are executable with:
```bash
npx ts-node examples/basic/01-basic-email-masking.ts
```

## Configuration

Presets available:
- `public` - Minimal masking
- `standard` - Balanced masking
- `strict` - High masking
- `audit` - Full redaction

## Security

No security vulnerabilities:
- No command injection
- No XSS risks
- No SQL injection concerns
- Pure data transformation
- No network calls

## License

MIT License

## Repository Structure

```
/
├── src/
│   ├── kernel.ts
│   ├── strategies.ts
│   ├── formats.ts
│   ├── types.ts
│   ├── errors.ts
│   ├── plugins/
│   │   ├── core/
│   │   └── optional/
│   └── utils/
├── tests/
│   ├── unit/
│   └── fixtures/
├── examples/
│   ├── basic/
│   ├── advanced/
│   └── real-world/
├── docs/
├── llms.txt
└── package.json
```

## Key Concepts

1. **Micro-kernel**: Minimal core with plugin extensions
2. **Plugin**: Self-contained masking logic
3. **Strategy**: How to mask the data
4. **Format**: How to present the masked data
5. **Validation**: Ensure data integrity before masking
6. **Type Safety**: Full TypeScript support
7. **Zero Dependencies**: Pure implementation
8. **Test Coverage**: 100% code coverage
9. **Examples**: 18 comprehensive examples
10. **Documentation**: Complete reference

## Common Use Cases

1. **API Response Masking** - Hide sensitive data in API responses
2. **Logging** - Prevent sensitive data in logs
3. **Database Storage** - Store masked data
4. **Data Export** - Export with appropriate masking
5. **Audit Trails** - Create masked audit logs
6. **GDPR Compliance** - Right to be forgotten
7. **Debugging** - Mask in development/staging
8. **Testing** - Use in test data
9. **Analytics** - Process data without exposure
10. **Third-party Integration** - Share masked data

## Best Practices

1. Use `format: 'log'` for production logs
2. Use `strategy: 'full'` for high-security scenarios
3. Validate data before masking
4. Use appropriate masking characters
5. Apply consistent masking across the application
6. Document masking strategies
7. Test masking with real data
8. Consider performance for large datasets
9. Use configuration presets
10. Handle errors gracefully
